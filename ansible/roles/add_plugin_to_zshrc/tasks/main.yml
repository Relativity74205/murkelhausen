- name: check if {{ new_plugin }} plugin is in .zshrc
  shell: grep -x 'plugins=.*{{ new_plugin }}.*' /home/{{ user }}/.zshrc | cat
  register: zshrc_content
  changed_when: false

- name: add {{ new_plugin }} plugin to .zshrc
  lineinfile:
    path: /home/{{ user }}/.zshrc
    regexp: 'plugins=\((.*)\)'
    line: 'plugins=(\1 {{ new_plugin }})'
    backrefs: yes
  when: zshrc_content.stdout == ""